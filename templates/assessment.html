{% extends "base.html" %}

{% block title %}Mental Wellness Assessment - Serenity{% endblock %}

{% block content %}
<div class="assessment-section">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="assessment-header text-center mb-5">
                    <div class="mb-4">
                        <lottie-player
                            src="https://assets3.lottiefiles.com/packages/lf20_V9t630.json"
                            background="transparent"
                            speed="1"
                            style="width: 120px; height: 120px; margin: 0 auto;"
                            loop
                            autoplay>
                        </lottie-player>
                    </div>
                    <h1 class="display-5 text-primary mb-3">Mental Health & Wellness Assessment</h1>
                    <p class="lead text-muted">
                        This assessment evaluates your current emotional state, coping strategies, and support needs to connect you with personalized mental health resources and a supportive community that understands your journey.
                    </p>
                    <div class="alert alert-info d-flex align-items-center">
                        <i class="fas fa-info-circle me-2"></i>
                        <small>
                            <strong>Privacy Note:</strong> Your responses are completely anonymous and used only to enhance your Serenity experience.
                        </small>
                    </div>
                </div>

                <form method="POST" id="assessmentForm">
                    <div class="assessment-questions">
                        {% for question in questions %}
                        <div class="question-card card shadow-sm border-0 mb-4">
                            <div class="card-body p-4">
                                <div class="question-header mb-4">
                                    <h4 class="question-number text-primary">Question {{ loop.index }} of {{ questions|length }}</h4>
                                    <h5 class="question-text">{{ question.question }}</h5>
                                </div>

                                <div class="question-options">
                                    {% for option in question.options %}
                                    <div class="form-check option-card mb-3">
                                        <input class="form-check-input" type="radio" 
                                               name="question_{{ question.id }}" 
                                               id="q{{ question.id }}_opt{{ loop.index0 }}" 
                                               value="{{ loop.index0 }}" required>
                                        <label class="form-check-label option-label" 
                                               for="q{{ question.id }}_opt{{ loop.index0 }}">
                                            <span class="option-text">{{ option.text }}</span>
                                        </label>
                                    </div>
                                    {% endfor %}
                                </div>

                                <div class="progress question-progress">
                                    <div class="progress-bar" role="progressbar" 
                                         style="width: {{ (loop.index / questions|length) * 100 }}%"
                                         aria-valuenow="{{ loop.index }}" 
                                         aria-valuemin="0" 
                                         aria-valuemax="{{ questions|length }}">
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>

                    <div class="assessment-footer text-center mt-5">
                        <div class="completion-check mb-4" id="completionStatus" style="display: none;">
                            <div class="alert alert-success d-flex align-items-center">
                                <i class="fas fa-check-circle me-2"></i>
                                <span>All questions answered! Ready to discover your color identity.</span>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary btn-lg px-5" id="submitButton" disabled>
                            <i class="fas fa-palette me-2"></i>
                            Discover My Color Identity
                        </button>

                        <div class="mt-3">
                            <small class="text-muted">
                                <i class="fas fa-clock me-1"></i>
                                This assessment typically takes 3-5 minutes to complete
                            </small>
                        </div>
                    </div>
                </form>

                <!-- What to Expect Section -->
                <div class="expectations-section mt-5 pt-5 border-top">
                    <div class="text-center mb-4">
                        <h3 class="text-primary">What to Expect</h3>
                        <p class="text-muted">After completing your assessment, you'll receive:</p>
                    </div>

                    <div class="row">
                        <div class="col-md-4 text-center mb-4">
                            <div class="expectation-card">
                                <i class="fas fa-palette fa-3x text-primary mb-3"></i>
                                <h5>Your Color Identity</h5>
                                <p class="text-muted small">
                                    A meaningful color identity that reflects your mental health needs and healing approach
                                </p>
                            </div>
                        </div>
                        <div class="col-md-4 text-center mb-4">
                            <div class="expectation-card">
                                <i class="fas fa-users fa-3x text-success mb-3"></i>
                                <h5>Support Group Matching</h5>
                                <p class="text-muted small">
                                    Assignment to an anonymous peer support group with similar mental health experiences
                                </p>
                            </div>
                        </div>
                        <div class="col-md-4 text-center mb-4">
                            <div class="expectation-card">
                                <i class="fas fa-heart fa-3x text-danger mb-3"></i>
                                <h5>Mental Health Resources</h5>
                                <p class="text-muted small">
                                    Personalized recommendations for support, coping strategies, and professional resources
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('assessmentForm');
        const submitButton = document.getElementById('submitButton');
        const completionStatus = document.getElementById('completionStatus');
        const totalQuestions = {{ questions|length }};
        
        // Track form completion
        function checkFormCompletion() {
            const answeredQuestions = form.querySelectorAll('input[type="radio"]:checked').length;
            const isComplete = answeredQuestions === totalQuestions;
            
            submitButton.disabled = !isComplete;
            
            if (isComplete) {
                completionStatus.style.display = 'block';
                submitButton.classList.add('pulse');
            } else {
                completionStatus.style.display = 'none';
                submitButton.classList.remove('pulse');
            }
            
            // Update progress
            const overallProgress = (answeredQuestions / totalQuestions) * 100;
            document.documentElement.style.setProperty('--assessment-progress', `${overallProgress}%`);
        }
        
        // Add event listeners to all radio buttons
        const radioButtons = form.querySelectorAll('input[type="radio"]');
        radioButtons.forEach(radio => {
            radio.addEventListener('change', function() {
                // Add visual feedback to selected option
                const questionCard = this.closest('.question-card');
                const allOptions = questionCard.querySelectorAll('.option-card');
                
                allOptions.forEach(option => {
                    option.classList.remove('selected');
                });
                
                this.closest('.option-card').classList.add('selected');
                
                // Check completion status
                checkFormCompletion();
                
                // Auto-scroll to next question
                const currentQuestion = questionCard;
                const nextQuestion = currentQuestion.nextElementSibling;
                
                if (nextQuestion && nextQuestion.classList.contains('question-card')) {
                    setTimeout(() => {
                        nextQuestion.scrollIntoView({ 
                            behavior: 'smooth', 
                            block: 'center' 
                        });
                    }, 300);
                }
            });
        });
        
        // Form submission with loading state
        form.addEventListener('submit', function(e) {
            submitButton.innerHTML = `
                <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                Discovering Your Identity...
            `;
            submitButton.disabled = true;
        });
        
        // Add hover effects to option cards
        const optionCards = document.querySelectorAll('.option-card');
        optionCards.forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.classList.add('hover');
            });
            
            card.addEventListener('mouseleave', function() {
                this.classList.remove('hover');
            });
        });
        
        // Initial check
        checkFormCompletion();
        
        // Add progress indicator to body
        const progressIndicator = document.createElement('div');
        progressIndicator.className = 'assessment-progress-indicator';
        progressIndicator.innerHTML = `
            <div class="progress-line">
                <div class="progress-fill"></div>
            </div>
        `;
        document.body.appendChild(progressIndicator);
    });
</script>

<style>
    :root {
        --assessment-progress: 0%;
    }
    
    .assessment-progress-indicator {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1000;
        height: 4px;
        background: rgba(0,0,0,0.1);
    }
    
    .progress-line {
        height: 100%;
        background: transparent;
    }
    
    .progress-fill {
        height: 100%;
        width: var(--assessment-progress);
        background: linear-gradient(90deg, #007bff, #28a745);
        transition: width 0.3s ease;
    }
    
    .option-card {
        border: 2px solid transparent;
        border-radius: 8px;
        padding: 12px 16px;
        cursor: pointer;
        transition: all 0.3s ease;
        background: rgba(0,123,255,0.05);
    }
    
    .option-card:hover,
    .option-card.hover {
        border-color: #007bff;
        background: rgba(0,123,255,0.1);
        transform: translateX(5px);
    }
    
    .option-card.selected {
        border-color: #007bff;
        background: rgba(0,123,255,0.15);
        box-shadow: 0 2px 8px rgba(0,123,255,0.2);
    }
    
    .option-label {
        cursor: pointer;
        margin-left: 8px;
        font-weight: 500;
    }
    
    .question-progress {
        height: 6px;
        background: rgba(0,0,0,0.1);
        border-radius: 3px;
        margin-top: 20px;
    }
    
    .pulse {
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }
    
    .expectation-card {
        padding: 20px;
        border-radius: 8px;
        transition: transform 0.3s ease;
    }
    
    .expectation-card:hover {
        transform: translateY(-5px);
    }
</style>
{% endblock %}
